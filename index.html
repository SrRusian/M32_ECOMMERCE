<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MOLINO32</title>
    <link rel="stylesheet" href="styles/home.css" />
    <link rel="stylesheet" href="styles/navbar.css" />
    <link rel="stylesheet" href="styles/general.css" />
    <link rel="stylesheet" href="styles/footer.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- NAVBAR IMPORT -->
    <div id="site-header"></div>
    <script src="/scripts/header-loader.js" defer></script>

    <section class="hero-section section" id="hero">
      <div class="hero-content">
        <h1>
          <span class="hero-title-main">Molino32</span><br />
          <span class="hero-title-sub">Cursos de Cocina</span>
        </h1>
        <p>
          Transfoma tu pasión culinaria en arte con nuestros cursos guiados por
          chefs expertos.
        </p>
        <div class="hero-buttons">
          <a href="courses.html" class="btn-main">
            Explorar Cursos <i class="fa-solid fa-arrow-right"></i>
          </a>
          <a href="#" class="btn-outline">Ver Demo Gratis</a>
        </div>
      </div>
      <div class="hero-image-container">
        <img
          src="assets/images/introduction.jpg"
          alt="Cocinando"
          class="hero-image"
        />
        <div class="hero-badge">
          <i class="fa-solid fa-user-group"></i>
          <div>
            <strong>12,000+</strong><br />
            <span>Estudiantes Activos</span>
          </div>
        </div>
      </div>
    </section>

    <section class="why-section section" id="why">
      <div>
        <h2>¿Por qué elegir Molino32?</h2>
        <p>
          Ofrecemos la experiencia de aprendizaje culinario más completa con
          instructores de clase mundial
        </p>
        <div class="why-cards">
          <div class="why-card">
            <div class="why-icon">
              <i class="bx bx-restaurant"></i>
            </div>
            <h3>Chefs Profesionales</h3>
            <p>Aprende de chefs con experiencia en cocinas internacionales</p>
          </div>
          <div class="why-card">
            <div class="why-icon">
              <i class="bx bx-book-open"></i>
            </div>
            <h3>Contenido Interactivo</h3>
            <p>Videos HD, recetas descargables y ejercicios prácticos</p>
          </div>
          <div class="why-card">
            <div class="why-icon">
              <i class="bx bx-award"></i>
            </div>
            <h3>Certificación</h3>
            <p>Obtén certificados que validen tus habilidades culinarias</p>
          </div>
        </div>
      </div>
    </section>

    <section class="featured-section section" id="featured">
      <div>
        <h2>Cursos Destacados</h2>
        <p>Una selección aleatoria de cursos para comenzar</p>

        <div class="featured-cards" id="featured-cards">
          <!-- Se inyectan 3 cards dinámicamente -->
        </div>

        <div class="featured-all">
          <a href="courses.html" class="btn-outline">Ver Todos los Cursos</a>
        </div>
      </div>
    </section>

    <!-- FOOTER IMPORT -->
    <div id="site-footer"></div>
    <script src="/scripts/footer-loader.js" defer></script>

    <script>
      // ---------- small helpers ----------
      function escapeHtml(s) {
        return String(s || "")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;");
      }
      function formatPrice(n) {
        if (n == null || n === "") return "$0.00";
        return "$" + Number(n).toFixed(2);
      }

      // ---------- fetch 3 random featured courses ----------
      async function loadFeatured() {
        try {
          const res = await fetch("https://molino32.com/api/get-courses.php");
          if (!res.ok) throw new Error("Network");
          const json = await res.json();
          const list = json.data || [];
          if (!list.length) {
            document.getElementById("featured-cards").innerHTML =
              "<p>No hay cursos disponibles.</p>";
            return;
          }
          // shuffle & take 3
          const shuffled = list.sort(() => Math.random() - 0.5).slice(0, 3);
          const container = document.getElementById("featured-cards");
          container.innerHTML = "";
          shuffled.forEach((c) => {
            const img = c.img || c.image || "assets/images/placeholder.jpg";
            const discount = c.discount
              ? `<span class="featured-discount">${escapeHtml(
                  c.discount
                )}% OFF</span>`
              : "";
            const rating = c.rating || "0";
            const time = c.time ? `${escapeHtml(c.time)} h` : "";
            const lessons = c.sections ?? c.lessons ?? "";
            const users = c.users ?? "";
            const card = document.createElement("div");
            card.className = "featured-card";
            card.innerHTML = `
              <div class="featured-card-img">
                ${discount}
                <button class="featured-fav" title="Favorito"><i class="bx bx-heart"></i></button>
                <img src="${escapeHtml(img)}" alt="${escapeHtml(
              c.alt || c.name
            )}" />
              </div>
              <div class="featured-card-body">
                <span class="featured-level">${escapeHtml(
                  c._difficulty || c.difficulty || ""
                )}</span>
                <span class="featured-rating"><i class="bx bxs-star"></i> ${escapeHtml(
                  rating
                )}</span>
                <h3>${escapeHtml(c.name || c.title || "")}</h3>
                <p class="featured-chef">Por ${escapeHtml(
                  c.author || c.chef || "Instructor"
                )}</p>
                <p class="featured-desc">${escapeHtml(
                  (c.description || "").slice(0, 140)
                )}</p>
                <div class="featured-info">
                  <span title="Duración"><i class="bx bx-time"></i> ${escapeHtml(
                    time
                  )}</span>
                  <span title="Lecciones"><i class="bx bx-book-open"></i> ${escapeHtml(
                    lessons
                  )}</span>
                  <span title="Alumnos"><i class="bx bx-group"></i> ${escapeHtml(
                    users
                  )}</span>
                </div>
                <div class="featured-price-row">
                  <span class="featured-price">${formatPrice(c.price)}</span>
                  <button class="btn-main featured-cart" onclick="location.href='courses.html'">Ver Curso</button>
                </div>
              </div>
            `;
            container.appendChild(card);
          });
        } catch (e) {
          console.error(e);
          document.getElementById("featured-cards").innerHTML =
            "<p>Error cargando cursos.</p>";
        }
      }

      // ---------- auto-scroll with wheel & touch ----------
      (function () {
        const sections = Array.from(document.querySelectorAll(".section"));
        let scrolling = false;
        let current = 0;

        // intersection observer to set current and add in-view class
        const io = new IntersectionObserver(
          (entries) => {
            entries.forEach((ent) => {
              if (ent.isIntersecting) {
                ent.target.classList.add("in-view");
                current = sections.indexOf(ent.target);
              }
            });
          },
          { threshold: 0.5 }
        );
        sections.forEach((s) => io.observe(s));

        // wheel handler
        window.addEventListener(
          "wheel",
          (e) => {
            if (scrolling) return;
            if (Math.abs(e.deltaY) < 10) return;
            if (e.deltaY > 0 && current < sections.length - 1) {
              scrolling = true;
              sections[current + 1].scrollIntoView({ behavior: "smooth" });
              setTimeout(() => (scrolling = false), 900);
            } else if (e.deltaY < 0 && current > 0) {
              scrolling = true;
              sections[current - 1].scrollIntoView({ behavior: "smooth" });
              setTimeout(() => (scrolling = false), 900);
            }
          },
          { passive: true }
        );

        // touch swipe
        let startY = null;
        window.addEventListener(
          "touchstart",
          (e) => (startY = e.touches[0].clientY),
          { passive: true }
        );
        window.addEventListener(
          "touchend",
          (e) => {
            if (startY == null) return;
            const endY = e.changedTouches[0].clientY;
            const diff = startY - endY;
            if (Math.abs(diff) < 40) return;
            if (scrolling) return;
            if (diff > 0 && current < sections.length - 1) {
              scrolling = true;
              sections[current + 1].scrollIntoView({ behavior: "smooth" });
              setTimeout(() => (scrolling = false), 900);
            }
            if (diff < 0 && current > 0) {
              scrolling = true;
              sections[current - 1].scrollIntoView({ behavior: "smooth" });
              setTimeout(() => (scrolling = false), 900);
            }
            startY = null;
          },
          { passive: true }
        );
      })();

      // ---------- init ----------
      document.addEventListener("DOMContentLoaded", () => {
        loadFeatured();
      });
    </script>
  </body>
</html>
